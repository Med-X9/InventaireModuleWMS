# Commandes pour tester l'API Counting Detail via le shell Django
# Utilisez: python manage.py shell < test_api_commands.txt

from apps.mobile.services.counting_detail_service import CountingDetailService
from apps.inventory.models import CountingDetail, ComptageSequence, EcartComptage
import json

service = CountingDetailService()

print("=" * 60)
print("ðŸ§ª TEST UPSERT - Counting Detail Service")
print("=" * 60)

# Test 1: CrÃ©ation
print("\nðŸ“ Test 1: CrÃ©ation d'un nouveau CountingDetail")
data_create = [{
    "counting_id": 107,
    "location_id": 828,
    "quantity_inventoried": 5,
    "assignment_id": 58,
    "product_id": 3766
}]

result1 = service.create_counting_details_batch(data_create, job_id=32)
print(f"Status: {'âœ… SuccÃ¨s' if result1.get('success') else 'âŒ Ã‰chec'}")
print(f"Ã‰lÃ©ments traitÃ©s: {result1.get('successful', 0)}/{result1.get('total_processed', 0)}")

if result1.get('success'):
    results = result1.get('results', [])
    if results:
        action = results[0].get('result', {}).get('action')
        print(f"Action: {action}")
        counting_detail_id = results[0].get('result', {}).get('counting_detail', {}).get('id')
        print(f"CountingDetail ID: {counting_detail_id}")

# Test 2: Mise Ã  jour (UPSERT)
print("\nðŸ“ Test 2: Mise Ã  jour d'un CountingDetail existant (UPSERT)")
data_update = [{
    "counting_id": 107,
    "location_id": 828,
    "quantity_inventoried": 7,
    "assignment_id": 58,
    "product_id": 3766
}]

result2 = service.create_counting_details_batch(data_update, job_id=32)
print(f"Status: {'âœ… SuccÃ¨s' if result2.get('success') else 'âŒ Ã‰chec'}")
print(f"Ã‰lÃ©ments traitÃ©s: {result2.get('successful', 0)}/{result2.get('total_processed', 0)}")

if result2.get('success'):
    results = result2.get('results', [])
    if results:
        action = results[0].get('result', {}).get('action')
        print(f"Action: {action} (devrait Ãªtre 'updated')")

print("\nâœ… Tests terminÃ©s")

