Branch indexing
 > git rev-parse --resolve-git-dir /var/jenkins_home/caches/git-9a34e588d40d382664698b8646517189/.git # timeout=10
Setting origin to https://github.com/Med-X9/InventaireModuleWMS.git
 > git config remote.origin.url https://github.com/Med-X9/InventaireModuleWMS.git # timeout=10
Fetching origin...
Fetching upstream changes from origin
 > git --version # timeout=10
 > git --version # 'git version 2.39.5'
 > git config --get remote.origin.url # timeout=10
using GIT_ASKPASS to set credentials github-creds
 > git fetch --tags --force --progress -- origin +refs/heads/*:refs/remotes/origin/* # timeout=10
Seen branch in repository origin/dev
Seen branch in repository origin/dev-2
Seen branch in repository origin/devops
Seen branch in repository origin/main
Seen 4 remote branches
Obtained Jenkinsfile from 7cb9ee018170c4127fc21014e1e397190422c33e
[Pipeline] Start of Pipeline
[Pipeline] node
Running on Jenkins in /var/jenkins_home/workspace/WMS_dev
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Declarative: Checkout SCM)
[Pipeline] checkout
The recommended git tool is: git
using credential github-creds
 > git rev-parse --resolve-git-dir /var/jenkins_home/workspace/WMS_dev/.git # timeout=10
Fetching changes from the remote Git repository
 > git config remote.origin.url https://github.com/Med-X9/InventaireModuleWMS.git # timeout=10
Fetching without tags
Fetching upstream changes from https://github.com/Med-X9/InventaireModuleWMS.git
 > git --version # timeout=10
 > git --version # 'git version 2.39.5'
using GIT_ASKPASS to set credentials github-creds
 > git fetch --no-tags --force --progress -- https://github.com/Med-X9/InventaireModuleWMS.git +refs/heads/*:refs/remotes/origin/* # timeout=10
Checking out Revision 7cb9ee018170c4127fc21014e1e397190422c33e (dev)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f 7cb9ee018170c4127fc21014e1e397190422c33e # timeout=10
Commit message: "update"
 > git rev-list --no-walk 62c6475125242c205be8ee059ac0ee56164674c2 # timeout=10
[Pipeline] }
[Pipeline] // stage
[Pipeline] withEnv
[Pipeline] {
[Pipeline] withEnv
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Check Branch)
[Pipeline] script
[Pipeline] {
[Pipeline] echo
Proceeding with deployment on dev branch to development environment
[Pipeline] echo
Deploy target: 147.93.55.221
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Clone Repositories)
[Pipeline] withCredentials
Masking supported pattern matches of $GIT_PASS
[Pipeline] {
[Pipeline] sh
+ rm -rf /tmp/backend
+ echo Cloning repository branch dev...
Cloning repository branch dev...
+ git clone --single-branch --branch dev https://Med-X9:****@github.com/Med-X9/InventaireModuleWMS.git /tmp/backend
Cloning into '/tmp/backend'...
+ [ ! -d /tmp/backend ]
+ ls -A /tmp/backend
+ [ -z .cursorrules
.dockerignore
.env copy
.git
.gitattributes
.gitignore
DATATABLE_ENDPOINTS.md
Dockerfile
GUIDE_OPTIMISATION_PERFORMANCE.md
Jenkinsfile
Jenkinsfile.backup
RAPPORT_PERFORMANCE_APPS.md
SECURITY.md
apps
config
diagnostic_502.sh
diagnostic_postgres.sh
docker-compose.yml
error.txt
fix_postgres_connection.sh
fix_postgres_quick.sh
jenkins-config.yml
manage.py
nginx
package.json
project
requirements.txt
static
staticfiles
templates
test_api_commands.txt
test_counting_detail_api.py
test_counting_detail_service.py
test_counting_detail_simple.py ]
+ echo ✓ Repository cloned successfully
✓ Repository cloned successfully
+ cd /tmp/backend
+ git branch --show-current
+ echo Current branch: dev
Current branch: dev
+ git rev-parse HEAD
+ echo Commit: 7cb9ee018170c4127fc21014e1e397190422c33e
Commit: 7cb9ee018170c4127fc21014e1e397190422c33e
+ pwd
+ echo Working directory: /tmp/backend
Working directory: /tmp/backend
+ echo Files in repository root:
Files in repository root:
+ ls -la
+ head -20
total 268
drwxr-xr-x 10 jenkins jenkins  4096 Nov 24 14:50 .
drwxrwxrwt  1 root    root     4096 Nov 24 14:50 ..
-rw-r--r--  1 jenkins jenkins  5483 Nov 24 14:50 .cursorrules
-rw-r--r--  1 jenkins jenkins   634 Nov 24 14:50 .dockerignore
-rw-r--r--  1 jenkins jenkins  4119 Nov 24 14:50 .env copy
drwxr-xr-x  8 jenkins jenkins  4096 Nov 24 14:50 .git
-rw-r--r--  1 jenkins jenkins    66 Nov 24 14:50 .gitattributes
-rw-r--r--  1 jenkins jenkins   668 Nov 24 14:50 .gitignore
-rw-r--r--  1 jenkins jenkins  7442 Nov 24 14:50 DATATABLE_ENDPOINTS.md
-rw-r--r--  1 jenkins jenkins  1598 Nov 24 14:50 Dockerfile
-rw-r--r--  1 jenkins jenkins 23780 Nov 24 14:50 GUIDE_OPTIMISATION_PERFORMANCE.md
-rw-r--r--  1 jenkins jenkins 22851 Nov 24 14:50 Jenkinsfile
-rw-r--r--  1 jenkins jenkins 16657 Nov 24 14:50 Jenkinsfile.backup
-rw-r--r--  1 jenkins jenkins  9659 Nov 24 14:50 RAPPORT_PERFORMANCE_APPS.md
-rw-r--r--  1 jenkins jenkins  5963 Nov 24 14:50 SECURITY.md
drwxr-xr-x  7 jenkins jenkins  4096 Nov 24 14:50 apps
drwxr-xr-x  3 jenkins jenkins  4096 Nov 24 14:50 config
-rw-r--r--  1 jenkins jenkins  2881 Nov 24 14:50 diagnostic_502.sh
-rw-r--r--  1 jenkins jenkins  7175 Nov 24 14:50 diagnostic_postgres.sh
+ [ ! -f Dockerfile ]
+ [ ! -r Dockerfile ]
+ echo ✓ Dockerfile found and readable
✓ Dockerfile found and readable
+ echo Dockerfile preview (first 5 lines):
Dockerfile preview (first 5 lines):
+ head -5 Dockerfile
# Stage 1: Builder
FROM python:3.12.1-slim as builder

# Variables d'environnement pour Python
ENV PYTHONUNBUFFERED=1 \
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (SonarQube Analysis)
[Pipeline] tool
[Pipeline] withEnv
[Pipeline] {
[Pipeline] dir
Running in /tmp/backend
[Pipeline] {
[Pipeline] script
[Pipeline] {
[Pipeline] sh
+ echo Setting up Python environment...
Setting up Python environment...
+ python3 -m pip install --user -r requirements.txt
/usr/bin/python3: No module named pip
+ echo Warning: Failed to install some dependencies, continuing with analysis...
Warning: Failed to install some dependencies, continuing with analysis...
[Pipeline] withSonarQubeEnv
Injecting SonarQube environment variables using the configuration: SonarQube-Server
[Pipeline] {
[Pipeline] sh
+ echo Starting SonarQube analysis for branch: dev
Starting SonarQube analysis for branch: dev
+ /var/jenkins_home/tools/hudson.plugins.sonar.SonarRunnerInstallation/sonar-scanner/bin/sonar-scanner -Dsonar.projectKey=inventaire-module-wms-dev -Dsonar.projectName=InventaireModuleWMS-dev -Dsonar.projectVersion=1.0 -Dsonar.sources=apps,project,config -Dsonar.sourceEncoding=UTF-8 -Dsonar.language=py -Dsonar.python.version=3.12 -Dsonar.tests=apps -Dsonar.test.inclusions=**/tests/**/*.py,**/test_*.py -Dsonar.exclusions=**/migrations/**,**/staticfiles/**,**/static/**,**/media/**,**/__pycache__/**,**/venv/**,**/env/**,**/node_modules/**,**/*.pyc,**/manage.py,**/wsgi.py,**/asgi.py,**/settings/**,**/*.min.js,**/*.min.css -Dsonar.coverage.exclusions=**/migrations/**,**/tests/**,**/test_*.py,**/conftest.py,**/manage.py,**/wsgi.py,**/asgi.py,**/settings/**,**/__init__.py -Dsonar.cpd.exclusions=**/migrations/**,**/tests/** -Dsonar.qualitygate.wait=false
14:51:11.019 INFO  Scanner configuration file: /var/jenkins_home/tools/hudson.plugins.sonar.SonarRunnerInstallation/sonar-scanner/conf/sonar-scanner.properties
14:51:11.028 INFO  Project root configuration file: NONE
14:51:11.080 INFO  SonarScanner CLI 7.2.0.5079
14:51:11.090 INFO  Linux 5.15.0-1078-kvm amd64
14:51:20.276 ERROR Failed to query server version: Call to URL [http://147.93.55.221:9000/api/v2/analysis/version] failed: Connect timed out
14:51:20.276 INFO  EXECUTION FAILURE
14:51:20.277 INFO  Total time: 9.310s
[Pipeline] }
WARN: Unable to locate 'report-task.txt' in the workspace. Did the SonarScanner succeed?
[Pipeline] // withSonarQubeEnv
[Pipeline] echo
Warning: SonarQube analysis encountered issues but continuing build: script returned exit code 1
[Pipeline] echo
Check SonarQube dashboard for detailed analysis results
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // dir
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (SonarQube Status Check)
[Pipeline] script
[Pipeline] {
[Pipeline] sleep
Sleeping for 10 sec
[Pipeline] withCredentials
Masking supported pattern matches of $SONAR_PASS
[Pipeline] {
[Pipeline] sh
+ curl -s -u admin:**** http://147.93.55.221:9000/api/qualitygates/project_status?projectKey=inventaire-module-wms-dev
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] echo
⚠️  SonarQube status check failed: script returned exit code 28
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Build Backend Docker Image)
[Pipeline] script
[Pipeline] {
[Pipeline] sh
+ test -d /tmp/backend
+ test -f /tmp/backend/Dockerfile
[Pipeline] echo
✓ /tmp/backend exists and contains Dockerfile, proceeding...
[Pipeline] }
[Pipeline] // script
[Pipeline] dir
Running in /tmp/backend
[Pipeline] {
[Pipeline] script
[Pipeline] {
[Pipeline] sh
+ echo Checking for Dockerfile in /tmp/backend...
Checking for Dockerfile in /tmp/backend...
+ pwd
+ echo Current directory: /tmp/backend
Current directory: /tmp/backend
+ echo Files in current directory:
Files in current directory:
+ ls -la
+ head -20
total 268
drwxr-xr-x 10 jenkins jenkins  4096 Nov 24 14:50 .
drwxrwxrwt  1 root    root     4096 Nov 24 14:50 ..
-rw-r--r--  1 jenkins jenkins  5483 Nov 24 14:50 .cursorrules
-rw-r--r--  1 jenkins jenkins   634 Nov 24 14:50 .dockerignore
-rw-r--r--  1 jenkins jenkins  4119 Nov 24 14:50 .env copy
drwxr-xr-x  8 jenkins jenkins  4096 Nov 24 14:50 .git
-rw-r--r--  1 jenkins jenkins    66 Nov 24 14:50 .gitattributes
-rw-r--r--  1 jenkins jenkins   668 Nov 24 14:50 .gitignore
-rw-r--r--  1 jenkins jenkins  7442 Nov 24 14:50 DATATABLE_ENDPOINTS.md
-rw-r--r--  1 jenkins jenkins  1598 Nov 24 14:50 Dockerfile
-rw-r--r--  1 jenkins jenkins 23780 Nov 24 14:50 GUIDE_OPTIMISATION_PERFORMANCE.md
-rw-r--r--  1 jenkins jenkins 22851 Nov 24 14:50 Jenkinsfile
-rw-r--r--  1 jenkins jenkins 16657 Nov 24 14:50 Jenkinsfile.backup
-rw-r--r--  1 jenkins jenkins  9659 Nov 24 14:50 RAPPORT_PERFORMANCE_APPS.md
-rw-r--r--  1 jenkins jenkins  5963 Nov 24 14:50 SECURITY.md
drwxr-xr-x  7 jenkins jenkins  4096 Nov 24 14:50 apps
drwxr-xr-x  3 jenkins jenkins  4096 Nov 24 14:50 config
-rw-r--r--  1 jenkins jenkins  2881 Nov 24 14:50 diagnostic_502.sh
-rw-r--r--  1 jenkins jenkins  7175 Nov 24 14:50 diagnostic_postgres.sh
+ [ ! -f Dockerfile ]
+ echo ✓ Dockerfile found, proceeding with build...
✓ Dockerfile found, proceeding with build...
+ echo Dockerfile content (first 10 lines):
Dockerfile content (first 10 lines):
+ head -10 Dockerfile
# Stage 1: Builder
FROM python:3.12.1-slim as builder

# Variables d'environnement pour Python
ENV PYTHONUNBUFFERED=1 \
    PYTHONDONTWRITEBYTECODE=1 \
    PIP_NO_CACHE_DIR=1 \
    PIP_DISABLE_PIP_VERSION_CHECK=1

WORKDIR /app
[Pipeline] sh
+ docker build -t smatchdigital/backend-app:dev-latest .
#1 [internal] load build definition from Dockerfile
#1 sha256:15837e79737d20e596d55cb1642add376efd70914600f6cadaa48f9dfbbcc62e
#1 transferring dockerfile: 1.64kB done
#1 DONE 0.0s

#2 [internal] load metadata for docker.io/library/python:3.12.1-slim
#2 sha256:a07069dc958021cc816bea7823fc3e4954b38af80da9bf1f3712dfeed56385e8
#2 ...

#3 [auth] library/python:pull token for registry-1.docker.io
#3 sha256:ff985c1ba182964bd53583abcc489524417b9e0115f0ebe4b3c10e6c7aada2e3
#3 DONE 0.0s

#2 [internal] load metadata for docker.io/library/python:3.12.1-slim
#2 sha256:a07069dc958021cc816bea7823fc3e4954b38af80da9bf1f3712dfeed56385e8
#2 DONE 0.5s

#4 [internal] load .dockerignore
#4 sha256:ef716e805f7da52b86069994d95a2793f649c43706f6379da5172c3c0a730f34
#4 transferring context: 676B done
#4 DONE 0.0s

#7 [builder 1/6] FROM docker.io/library/python:3.12.1-slim@sha256:a64ac5be6928c6a94f00b16e09cdf3ba3edd44452d10ffa4516a58004873573e
#7 sha256:e273cb5ac7a1cd05346c91f29188df86b54dfbe0e1ebda7e0d9226be2c00a93a
#7 DONE 0.0s

#13 [internal] load build context
#13 sha256:4d3d6b671b0c86b3d62466c9178fe25ff7662d78fef494361c2c99e5dc0e27fc
#13 transferring context: 30.89MB 0.4s done
#13 DONE 0.4s

#5 [stage-1 3/6] RUN apt-get update && apt-get install -y --no-install-recommends     libpq5     && rm -rf /var/lib/apt/lists/*
#5 sha256:bb0994fa5efab918fda64aaeca4ba2184bf7a67b8155a2ab03061d0689f46a27
#5 CACHED

#12 [builder 5/6] COPY requirements.txt .
#12 sha256:e2993d6fbb577aa8c2bf34ec7777e2163cbb6e5af1d0e495ca6d77222ac9915f
#12 CACHED

#6 [builder 2/6] WORKDIR /app
#6 sha256:3cfad0fb69c30b17bc7c6cf818a99fde99eaf4f1a1ff164269b8600d574dbb56
#6 CACHED

#15 [builder 3/6] RUN apt-get update && apt-get install -y --no-install-recommends     build-essential     libpq-dev     && rm -rf /var/lib/apt/lists/*
#15 sha256:0b137bf840eb80a2ae7b9508d71339d3701a3b0ad03c0fd9e39f41970a7a5b83
#15 CACHED

#14 [builder 4/6] RUN python -m venv /opt/venv
#14 sha256:87d9ea77699748e335a90c9a0a1b642b3b3b9c19b1e3bc6f20b1da36b153a187
#14 CACHED

#11 [builder 6/6] RUN pip install --no-cache-dir -r requirements.txt gunicorn
#11 sha256:de682e4ec4127fdadd1c1ad1a4afdf54f713975b2bf845a4036bee4211ddd0fb
#11 CACHED

#10 [stage-1 4/6] COPY --from=builder /opt/venv /opt/venv
#10 sha256:b721a61e180e1cf520a41e358cff4177fc423139aae8263ef5a4a96cdbfd53f8
#10 CACHED

#9 [stage-1 5/6] COPY . .
#9 sha256:0492909788e5dda0534fb41f326743b0cc5f62527d45b155f935068413441189
#9 DONE 0.4s

#8 [stage-1 6/6] RUN mkdir -p /app/static /app/media /app/logs     && chmod -R 755 /app/static /app/media     && chmod -R 777 /app/logs     && useradd -U app_user     && chown -R app_user:app_user /app
#8 sha256:2936e6e14f83f88239339b49e6e00c626f8ce971865ed817caa4808cfa1f4c63
#8 DONE 1.7s

#16 exporting to image
#16 sha256:f6d502bbadc76a8f80248b1c2489196542c06c4b09f8dab43bb640b5521b74d8
#16 exporting layers
#16 exporting layers 0.3s done
#16 writing image sha256:6c00d9c92ef4275342c082a374bba13430b936a204acceb0a6361152a0d2d489 done
#16 naming to docker.io/smatchdigital/backend-app:dev-latest done
#16 DONE 0.3s
[Pipeline] sh
+ docker tag smatchdigital/backend-app:dev-latest smatchdigital/backend-app:latest
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // dir
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Push Docker Images)
[Pipeline] script
[Pipeline] {
[Pipeline] withCredentials
Masking supported pattern matches of $PASS
[Pipeline] {
[Pipeline] sh
Warning: A secret was passed to "sh" using Groovy String interpolation, which is insecure.
		 Affected argument(s) used the following variable(s): [PASS]
		 See https://jenkins.io/redirect/groovy-string-interpolation for details.
+ echo ****
+ docker login -u smatchdigital --password-stdin
WARNING! Your password will be stored unencrypted in /var/jenkins_home/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/#credentials-store

Login Succeeded
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] sh
+ docker push smatchdigital/backend-app:dev-latest
The push refers to repository [docker.io/smatchdigital/backend-app]
90d18aba7f80: Preparing
8c100395a66c: Preparing
805052629f50: Preparing
42c156d3ff0d: Preparing
acac357f5b53: Preparing
6fdc32920d25: Preparing
41aaeb647441: Preparing
95ac61d1a52e: Preparing
da5d55102092: Preparing
fb1bd2fc5282: Preparing
6fdc32920d25: Waiting
41aaeb647441: Waiting
95ac61d1a52e: Waiting
da5d55102092: Waiting
fb1bd2fc5282: Waiting
805052629f50: Layer already exists
42c156d3ff0d: Layer already exists
acac357f5b53: Layer already exists
41aaeb647441: Layer already exists
6fdc32920d25: Layer already exists
95ac61d1a52e: Layer already exists
fb1bd2fc5282: Layer already exists
da5d55102092: Layer already exists
8c100395a66c: Pushed
90d18aba7f80: Pushed
dev-latest: digest: sha256:48c5f0737249e759f8f3863ff2c0d63dc878618a814a69f237442894c6194022 size: 2420
[Pipeline] sh
+ docker push smatchdigital/backend-app:latest
The push refers to repository [docker.io/smatchdigital/backend-app]
90d18aba7f80: Preparing
8c100395a66c: Preparing
805052629f50: Preparing
42c156d3ff0d: Preparing
acac357f5b53: Preparing
6fdc32920d25: Preparing
41aaeb647441: Preparing
95ac61d1a52e: Preparing
da5d55102092: Preparing
fb1bd2fc5282: Preparing
6fdc32920d25: Waiting
41aaeb647441: Waiting
95ac61d1a52e: Waiting
da5d55102092: Waiting
fb1bd2fc5282: Waiting
8c100395a66c: Layer already exists
90d18aba7f80: Layer already exists
805052629f50: Layer already exists
42c156d3ff0d: Layer already exists
acac357f5b53: Layer already exists
da5d55102092: Layer already exists
95ac61d1a52e: Layer already exists
6fdc32920d25: Layer already exists
41aaeb647441: Layer already exists
fb1bd2fc5282: Layer already exists
latest: digest: sha256:48c5f0737249e759f8f3863ff2c0d63dc878618a814a69f237442894c6194022 size: 2420
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Upload Essential Files)
[Pipeline] script
[Pipeline] {
[Pipeline] echo
Preparing deployment files for development environment with image: smatchdigital/backend-app:dev-latest
[Pipeline] withCredentials
Masking supported pattern matches of $PASS
[Pipeline] {
[Pipeline] sh
+ echo DEBUG: contenu de /tmp/backend
DEBUG: contenu de /tmp/backend
+ ls -la /tmp/backend
total 268
drwxr-xr-x 10 jenkins jenkins  4096 Nov 24 14:50 .
drwxrwxrwt  1 root    root     4096 Nov 24 14:50 ..
-rw-r--r--  1 jenkins jenkins  5483 Nov 24 14:50 .cursorrules
-rw-r--r--  1 jenkins jenkins   634 Nov 24 14:50 .dockerignore
-rw-r--r--  1 jenkins jenkins  4119 Nov 24 14:50 .env copy
drwxr-xr-x  8 jenkins jenkins  4096 Nov 24 14:50 .git
-rw-r--r--  1 jenkins jenkins    66 Nov 24 14:50 .gitattributes
-rw-r--r--  1 jenkins jenkins   668 Nov 24 14:50 .gitignore
-rw-r--r--  1 jenkins jenkins  7442 Nov 24 14:50 DATATABLE_ENDPOINTS.md
-rw-r--r--  1 jenkins jenkins  1598 Nov 24 14:50 Dockerfile
-rw-r--r--  1 jenkins jenkins 23780 Nov 24 14:50 GUIDE_OPTIMISATION_PERFORMANCE.md
-rw-r--r--  1 jenkins jenkins 22851 Nov 24 14:50 Jenkinsfile
-rw-r--r--  1 jenkins jenkins 16657 Nov 24 14:50 Jenkinsfile.backup
-rw-r--r--  1 jenkins jenkins  9659 Nov 24 14:50 RAPPORT_PERFORMANCE_APPS.md
-rw-r--r--  1 jenkins jenkins  5963 Nov 24 14:50 SECURITY.md
drwxr-xr-x  7 jenkins jenkins  4096 Nov 24 14:50 apps
drwxr-xr-x  3 jenkins jenkins  4096 Nov 24 14:50 config
-rw-r--r--  1 jenkins jenkins  2881 Nov 24 14:50 diagnostic_502.sh
-rw-r--r--  1 jenkins jenkins  7175 Nov 24 14:50 diagnostic_postgres.sh
-rw-r--r--  1 jenkins jenkins  2541 Nov 24 14:50 docker-compose.yml
-rw-r--r--  1 jenkins jenkins 22908 Nov 24 14:50 error.txt
-rw-r--r--  1 jenkins jenkins  8168 Nov 24 14:50 fix_postgres_connection.sh
-rw-r--r--  1 jenkins jenkins  1669 Nov 24 14:50 fix_postgres_quick.sh
-rw-r--r--  1 jenkins jenkins  3356 Nov 24 14:50 jenkins-config.yml
-rw-r--r--  1 jenkins jenkins   663 Nov 24 14:50 manage.py
drwxr-xr-x  2 jenkins jenkins  4096 Nov 24 14:50 nginx
-rw-r--r--  1 jenkins jenkins   268 Nov 24 14:50 package.json
drwxr-xr-x  5 jenkins jenkins  4096 Nov 24 14:50 project
-rw-r--r--  1 jenkins jenkins  1468 Nov 24 14:50 requirements.txt
drwxr-xr-x  3 jenkins jenkins  4096 Nov 24 14:50 static
drwxr-xr-x  8 jenkins jenkins  4096 Nov 24 14:50 staticfiles
drwxr-xr-x  3 jenkins jenkins  4096 Nov 24 14:50 templates
-rw-r--r--  1 jenkins jenkins  1974 Nov 24 14:50 test_api_commands.txt
-rw-r--r--  1 jenkins jenkins 10643 Nov 24 14:50 test_counting_detail_api.py
-rw-r--r--  1 jenkins jenkins  4991 Nov 24 14:50 test_counting_detail_service.py
-rw-r--r--  1 jenkins jenkins  6532 Nov 24 14:50 test_counting_detail_simple.py
+ echo DEBUG: docker-compose.yml
DEBUG: docker-compose.yml
+ ls -la /tmp/backend/docker-compose.yml
-rw-r--r-- 1 jenkins jenkins 2541 Nov 24 14:50 /tmp/backend/docker-compose.yml
+ sshpass -p **** ssh -o StrictHostKeyChecking=no root@147.93.55.221 rm -rf /tmp/deployment/backend && mkdir -p /tmp/deployment/backend/nginx
+ sshpass -p **** scp -o StrictHostKeyChecking=no /tmp/backend/docker-compose.yml root@147.93.55.221:/tmp/deployment/backend/
+ sshpass -p **** scp -o StrictHostKeyChecking=no /tmp/backend/Dockerfile root@147.93.55.221:/tmp/deployment/backend/
+ sshpass -p **** scp -r -o StrictHostKeyChecking=no /tmp/backend/nginx/Dockerfile /tmp/backend/nginx/nginx-ssl.conf /tmp/backend/nginx/nginx.conf root@147.93.55.221:/tmp/deployment/backend/nginx/
+ sshpass -p **** scp -o StrictHostKeyChecking=no /tmp/backend/.env copy root@147.93.55.221:/tmp/deployment/backend/.env
[Pipeline] sh
+ sshpass -p **** ssh -o StrictHostKeyChecking=no root@147.93.55.221 cd /tmp/deployment/backend && if grep -q '^IMAGE_TAG=' .env 2>/dev/null; then sed -i 's|^IMAGE_TAG=.*|IMAGE_TAG=dev-latest|' .env && echo 'Updated IMAGE_TAG=dev-latest in .env file'; else echo 'IMAGE_TAG=dev-latest' >> .env && echo 'Added IMAGE_TAG=dev-latest to .env file'; fi && echo 'Verifying IMAGE_TAG in .env:' && grep '^IMAGE_TAG=' .env || echo 'WARNING: IMAGE_TAG not found in .env'
Updated IMAGE_TAG=dev-latest in .env file
Verifying IMAGE_TAG in .env:
IMAGE_TAG=dev-latest
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Deploy Backend on Remote Server)
[Pipeline] script
[Pipeline] {
[Pipeline] withCredentials
Masking supported pattern matches of $PASS
[Pipeline] {
[Pipeline] sh
+ grep ^IMAGE_TAG= .env
+ cut -d= -f2
grep: .env: No such file or directory
+ sshpass -p **** ssh -o StrictHostKeyChecking=no root@147.93.55.221 cd /tmp/deployment/backend && if [ ! -f .env ]; then echo 'ERROR: .env file not found!' && exit 1; fi && if ! grep -q '^IMAGE_TAG=' .env; then echo 'ERROR: IMAGE_TAG not found in .env file!' && echo 'Adding IMAGE_TAG=dev-latest to .env...' && echo 'IMAGE_TAG=dev-latest' >> .env; fi && echo 'Verifying IMAGE_TAG in .env:' && grep '^IMAGE_TAG=' .env || echo 'WARNING: IMAGE_TAG not found' && IMAGE_TAG_VALUE= && if [ -z  ]; then echo 'ERROR: IMAGE_TAG has empty value' && exit 1; fi && echo IMAGE_TAG value:  && echo Expected image: smatchdigital/backend-app: && docker-compose down -v && docker-compose pull && docker-compose up -d
Verifying IMAGE_TAG in .env:
IMAGE_TAG=dev-latest
ERROR: IMAGE_TAG has empty value
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Declarative: Post Actions)
[Pipeline] script
[Pipeline] {
[Pipeline] sh
+ rm -rf /tmp/backend
+ docker system prune -f
Deleted Images:
untagged: smatchdigital/backend-app@sha256:1cdbdd5501d1d435565a03666236f545bf789872a839127a69167641e9538554
deleted: sha256:80b07fed1064d496441974e03480f8d8dfe43e6db7c12fd7fb7394421310634b

Deleted build cache objects:
pzmwfc6edzgtdcxr7w253tq2y
oal39glssozy51en7n09q45n6
i3gc1qmvvdcoifw3ncvpa15ip
vk816vh4deki0m5976l03ynsa
lgj18ojz6gefxzsgg1o0a4rio

Total reclaimed space: 92.46MB
[Pipeline] }
[Pipeline] // script
[Pipeline] script
[Pipeline] {
[Pipeline] echo
❌ Pipeline failed for development deployment!
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // node
[Pipeline] End of Pipeline
ERROR: script returned exit code 1
Finished: FAILURE
